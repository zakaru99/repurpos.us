<div class="proposal-detail-dialog">

  <!-- Top Title + Close -->
  <div class="dialog-header">
    <h5 class="section-title">Proposal Details</h5>
    <button class="close-btn" (click)="closeDialog()">x</button>
  </div>

  <!-- Top Card -->
  <div class="card-block">
    <div class="detail-row">
      <span class="label">ID</span>
      <span class="value">{{ data.id }}</span>
    </div>
    <div class="detail-row">
      <span class="label">Submitted By</span>
      <span class="value">{{ data.submittedBy }}</span>
    </div>
    <div class="detail-row">
      <span class="label">Email</span>
      <span class="value">{{ data.email || 'No email provided' }}</span>
    </div>
    <div class="detail-row">
      <span class="label">Institution</span>
      <span class="value">{{ data.institution || 'No institution provided' }}</span>
    </div>
    <div class="detail-row">
      <span class="label">Status</span>
      <span class="value status-badge" [ngClass]="data.status?.toLowerCase()">
        {{ data.status }}
      </span>
    </div>
    <div class="detail-row">
      <span class="label">Submitted On</span>
      <span class="value">{{ data.submittedOn | date:'mediumDate' }}</span>
    </div>
  </div>

  <div class="card-block" *ngIf="!showRejectForm && data.status === 'Pending'">
    <div class="sub-section">
      <h6>Indication</h6>
      <p>{{ data.indication || 'No indication provided.' }}</p>
    </div>
    <div class="sub-section dual">
      <div>
        <h6>Volume</h6>
        <p>{{ data.volume ? data.volume + ' µL' : 'Not specified' }}</p>
      </div>
      <div>
        <h6>Concentration</h6>
        <p>{{ data.concentration ? data.concentration + ' µM' : 'Not specified' }}</p>
      </div>
    </div>
    <div class="sub-section">
      <h6>Description</h6>
      <p>{{ data.description || 'No description provided.' }}</p>
    </div>
    <div class="sub-section">
      <h6>Notes</h6>
      <p>{{ data.notes || 'No notes available.' }}</p>
    </div>
  </div>

  <!-- Rejection card (shown when rejecting) -->
  <div class="card-block rejection-card" *ngIf="showRejectForm">
    <h6>Rejection justification</h6>
    <textarea id="denialReason" #rejectionTextarea class="rejection-textarea" [(ngModel)]="denialReason" rows="6" placeholder="Enter justification for rejection"></textarea>
    <div class="dialog-actions" style="margin-top:1rem;">
      <button class="btn-pill reject" (click)="confirmReject()" [disabled]="!denialReason || !denialReason.trim()">Confirm Reject</button>
      <button class="btn-pill" (click)="cancelReject()">Cancel</button>
    </div>
  </div>

  <!-- Approval Actions -->
  <div class="approval-actions" *ngIf="data.status === 'Pending'">
    <!-- Normal actions (hidden while rejection form is open) -->
    <div class="dialog-actions" *ngIf="!showRejectForm">
      <button class="btn-pill approve" (click)="approveProposal()">Approve</button>
      <button class="btn-pill reject" (click)="rejectProposal()">Reject</button>
    </div>
  </div>

  <div class="card-block" *ngIf="data.status === 'Rejected'">
    <h6>Denial Reason</h6>
    <div class="denial-text-box">
      <p *ngIf="data.denialReason; else noReason" class="denial-text">{{ data.denialReason }}</p>
      <ng-template #noReason>
        <p class="muted">No denial reason provided.</p>
      </ng-template>
    </div>
  </div>
</div>
